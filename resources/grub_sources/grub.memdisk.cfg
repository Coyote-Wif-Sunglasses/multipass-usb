function scan_imgs {
	isodirs="$*"
    for dir in $isodirs; do
		for img_file in ${dir}/*.img ${dir}/*.IMG; do
			if test -f "$img_file"; then
				echo "generating MEMDISK entry for $img_file"
				menuentry "$img_file via memdisk" "$img_file"{
					set iso_path="$2"
					linux16 /boot/grub/memdisk raw ro
					initrd16 $iso_path
				}
			fi
		done
	done
}

insmod regexp
scan_imgs /boot-isos /boot/boot-isos /bootisos /boot/bootisos /BOOTISOS /BOOT/BOOTISOS
